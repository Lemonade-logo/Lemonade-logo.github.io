<!Doctype: HTML w/ Processing>

<html>

  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Processing Demo</title>
      <script type="text/javascript" src="js/processing.js"></script>
  </head>
  
  <body>
    <h1>Granada High Tutorial</h1>
    <p>Processing demo</p>
    
    <script type="text/processing">
    
    void setup()
{
  size(800,620);
  gap = 231;
  score = 69;
  bg = loadImage("./img/bg.png");
  kirb = loadImage("./img/kirb.png");
  botPipe = loadImage("./img/pipe2.png");
  topPipe = loadImage("./img/pipe.png");
  kx = 100;
  ky = 50;
  g = 1; //Gravity == Speed of downward acceleration
  pipeX = new int[5];  //[0,0,0,0]
  pipeY = new int[pipeX.length];
  //POPULATE THE ARRAY WITH VALUES
  for(int i = 0; i < pipeX.length; i++)
  {
    pipeX[i] = width + 200*i;
    pipeY[i] = (int)random(-350, 0);
  } 
  gameState = -1;
}

//MAIN GAME LOOP
void draw()
{
  if(gameState == -1)
  {
    bigOlResetButton();
  } else if(gameState==0)
  {
    setBg();
    setPipes();
    kirb();  
    points();
  }
  else
  {
    text("YOU LOSE, TRY AGAIN?", 20,100);  
  }
}


void bigOlResetButton()
{
  image(bg,0,0);
  text("kirb",300,300);
  if(mousePressed) {
    ky = height/2;
    gameState = 0;
  }
}

void setPipes()
{
  //Move the Pipes
  for(int i = 0; i < pipeX.length; i++)
  {
   image(topPipe, pipeX[i], pipeY[i]);
   image(botPipe, pipeX[i], pipeY[i] + 480);
   pipeX[i]-= 2;
   if(pipeX[i] < -200)
   {
     pipeX[i] = width;  
   } 
   if(kx > (pipeX[i]-kirb.width) && kx < pipeX[i] + topPipe.width)
   {
     if(!(ky > pipeY[i] + topPipe.height && ky < pipeY[i] + (topPipe.height + gap)))
     {
       gameState = 1;
     } 
     else if (kx == pipeX[i] || kx == pipeX[i] + 1)
     {
       score = score + 1;
     }
   }
  }  
}

void points() {
  fill(0);
  text("Score: " + str(score), width = 170, 40);
  
}
void kirb()
{
   image(kirb, kx, ky);
   ky = ky + Vky;
   Vky = Vky + g;  
   if(ky > height || ky < 0)
   {
     gameState = 1;
   }
}

void mousePressed()
{
   Vky = -15;
   if(gameState==1) {
     bigOlResetButton();
   }
}


void setBg()
{
  image(bg, bgx, bgy);
  image(bg, bgx + bg.width, bgy);
  bgx--;
  if(bgx < -bg.width)
  {
     bgx = 0; //RESET images to starting position 
  }  
}
    </script>
    <canvas id="sketch" style="border: 1px solid black;"></canvas>
    
  </body>
  
</html>
